<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>POP MART Personality</title>
    <style>
        @font-face {
            font-family: 'DIN Pro';
            src: url('fonts/dinpro.woff2') format('woff2'),
                url('fonts/dinpro.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'DB Helvethaica X Bd Cond';
            src: url('fonts/dbhelvethaicaxbdcond.woff2') format('woff2'),
                url('fonts/DB Helvethaica X Bd Cond v3.2.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        :root {
            --primary-color: #E70022;
            --secondary-color: #FEE101;
            --background-color: #ffffff;
            --text-color: #333;
            --border-color: #ddd;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'DIN Pro', 'DB Helvethaica X Bd Cond', Tahoma, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 0;
        }

        /* Logo at the top of each container */
        .container-logo {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 8vh;
            padding: 1vh 0;
            margin-top: 3vh;
        }

        .container-logo img {
            height: 5vh;
            max-width: 200px;
            object-fit: contain;
        }

        /* Landing page styles - FIXED */
        .landing-page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .landing-banner {
            background-image: url('img/background.png');
            background-size: cover;
            background-position: bottom center;
            background-repeat: no-repeat;
            /* CHANGED: Use flex-grow to take available space */
            flex-grow: 1;


            overflow: hidden;
            /* ADDED: Minimum height to ensure proper display */
            min-height: calc(100vh);
        }

        .landing-content {
            background-color: #fff;
            height: 120px;
            /* FIXED: Exact height for calculations */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            flex-shrink: 0;
            /* Ensure this doesn't shrink */
            margin: 0;
            /* ADDED: Remove any margin */
            /* ADDED: Padding for button spacing */
        }

        .start-button {
            width: 90%;
            background-color: #000;
            color: #fff;
            border: none;
            border-radius: 1vh;
            padding: 15px 5vw;
            font-size: 5vw;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .start-button:hover {
            background-color: #333;
        }

        .intro {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 100vh;
        }

        .intro h2 {
            font-size: 7vw;
            margin-bottom: 1vh;
        }

        .intro p {
            font-size: 5.5vw;
        }

        /* Test container - CHANGED: Made scrollable */
        .test-container {
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            /* CHANGED: Use min-height for scrollability */
            overflow-y: auto;
            /* CHANGED: Allow vertical scrolling */
            overflow-x: hidden;
            /* Prevent horizontal scroll */
            width: 100%;
        }

        /* Background image container */
        .background-container {
            min-height: 70vh;
            /* CHANGED: Use min-height for flexibility */
            background-size: cover;
            background-position: bottom center;
            background-repeat: no-repeat;
            transition: background-image 0.3s ease;
            position: relative;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        /* Logo inside background container */
        .background-container .container-logo {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 8vh;
            padding: 1vh 0;
            margin-top: 3vh;
            position: relative;
            z-index: 10;
        }

        .background-container .container-logo img {
            height: 5vh;
            max-width: 200px;
            object-fit: contain;
        }

        /* Progress container inside background */
        .background-container .progress-container {
            background-color: transparent;
            padding: 1.5vh 4vw 0 4vw;
            /* REDUCED: Less padding for tighter spacing */
            position: relative;
            z-index: 10;
            margin-bottom: 0;
        }

        .progress-bar {
            height: 1vh;
            background-color: var(--border-color);
            border-radius: 0.5vh;
            overflow: hidden;
            width: 100%;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 5%;
        }

        #question-counter {
            text-align: center;
            font-size: 4.5vw;
            margin-top: 0.5vh;
            color: #666;
        }

        /* Questions wrapper - REDUCED gap */
        .questions-wrapper {
            flex: 1;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            /* CHANGED: Start from top to reduce gap */
            padding: 0.5vh 4vw 2vh 4vw;
            /* REDUCED: Less top padding */
            min-height: auto;
        }

        .question {
            display: none;
            width: 100%;
            flex-direction: column;
            justify-content: center;
            /* CHANGED: Center the content */
        }

        .question.active {
            display: flex;
        }

        /* Remove the image-container since we're using background images */
        .image-container {
            display: none;
        }

        .question-image {
            display: none;
        }

        .question-text {
            text-align: center;
            font-size: 9vw;
            padding: 0.5vh 0;
            font-weight: 500;
            line-height: 1.1;
            background-color: transparent;
            color: black;
            text-shadow: none;
            margin-bottom: 1vh;
            /* REDUCED: Less margin bottom for tighter spacing */
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 1vh;
            margin-bottom: 1vh;
            /* REDUCED: Less margin */
        }

        .options label {
            padding: 1vh 2.5vw;
            border: black solid 1px;
            border-radius: 1vh;
            text-align: center;
            cursor: pointer;
            font-size: 4vw;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 6vh;
            transition: all 0.2s;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            line-height: 1.2;
            background-color: rgba(255, 255, 255, 0.9);
            color: black;
        }

        .options input[type="radio"] {
            display: none;
        }

        .options input[type="radio"]:checked+label {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .test-controls {
            display: flex;
            justify-content: space-between;
            padding: 2vh 4vw 4vh 4vw;
            /* CHANGED: Adjusted padding */
            background-color: #ffffff;
            flex-shrink: 0;
            /* ADDED: Prevent shrinking */
        }

        .test-footer {
            text-align: center;
            padding: 0vh 4vw 2vh 4vw;
            background-color: #ffffff;
            font-size: 3vw;
            color: #3d3d3d;
            flex-shrink: 0;
        }

        button {
            padding: 1.5vh 5vw;
            background-color: #000;
            color: white;
            border: none;
            border-radius: 1vh;
            font-size: 5vw;
            cursor: pointer;
            font-family: 'DIN Pro', 'DB Helvethaica X Bd Cond', Tahoma, Verdana, sans-serif;
        }

        button:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }

        #prev-btn {
            background-color: #f0f0f0;
            color: var(--text-color);
        }

        /* Results section */
        .result-container {
            display: none;
            width: 100vw;
            min-height: 100vh;
            background-color: black;
            overflow: visible;
        }

        .personality-image {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            object-position: center;
            cursor: pointer;
        }

        /* Hide all other result elements */
        .result-container h2,
        .personality-type,
        #personality-title,
        .type-description,
        #restart-btn {
            display: none;
        }

        /* Mobile/small screen adjustments */
        @media (max-width: 767px) {
            .landing-banner {
                margin: 0;
                /* REMOVED: No margins for full height */
                border-radius: 0;
                /* REMOVED: No border radius */
            }

            .test-controls {
                padding: 1vh 4vw 1vh 4vw;
            }

            /* REMOVED: iOS Safari position fixed - now scrollable */
        }

        /* iPhone specific adjustments */
        @media (max-width: 414px) and (max-height: 896px) {
            .landing-banner {
                min-height: calc(100vh);


                background-position: center bottom;
            }
        }

        /* Very small screens (iPhone SE, etc.) */
        @media (max-width: 375px) and (max-height: 812px) {
            .landing-banner {
                min-height: calc(100vh);

                border-radius: 3vh;
            }
        }

        /* Height-based adjustments */
        @media (max-height: 700px) {
            .background-container {
                height: 45vh;
                /* REDUCED: Smaller height for short screens */
            }

            .questions-wrapper {
                padding: 0.25vh 4vw 1vh 4vw;
                /* REDUCED: Even less padding on short screens */
            }

            .options label {
                font-size: 3.8vw;
                min-height: 5.5vh;
                padding: 0.8vh 2vw;
            }

            .question-text {
                font-size: 8vw;
                margin-bottom: 0.75vh;
                /* REDUCED: Less margin on short screens */
            }

            .options {
                gap: 0.8vh;
                margin-bottom: 1vh;
            }

            .test-controls {
                padding: 1vh 4vw 2vh 4vw;
            }

            .test-footer {
                padding: 0.5vh 4vw 1vh 4vw;
                font-size: 3vw;
            }
        }



        @media (min-height: 700px) {
            .background-container {
                height: 50vh;
                /* REDUCED: Consistent with main rule */
            }

            .questions-wrapper {
                padding: 0.5vh 4vw 2vh 4vw;
                /* CONSISTENT: Same as main rule */
            }

            .options label {
                font-size: 4vw;
                min-height: 6vh;
            }

            .question-text {
                font-size: 9vw;
                margin-bottom: 1vh;
                /* CONSISTENT: Less margin */
            }
        }

        /* Desktop styles */
        @media (min-width: 768px) {
            body {
                align-items: center;
                justify-content: center;
                min-height: 100vh;
            }

            .container {
                max-width: 600px;
                width: 100%;
                margin: 0 auto;
            }

            .container-logo img {
                height: 7vh;
                max-width: 300px;
            }

            .intro h2 {
                font-size: 32px;
            }

            .intro p {
                font-size: 22px;
            }

            .question-text {
                font-size: 26px;
                color: white;
            }

            .options label {
                font-size: 18px;
                padding: 10px 15px;
                min-height: auto;
            }

            #question-counter {
                font-size: 18px;
            }

            button {
                font-size: 20px;
                padding: 10px 20px;
            }

            .personality-type {
                font-size: 38px;
            }

            #personality-title {
                font-size: 26px;
            }

            .type-description {
                font-size: 18px;
            }

            .trait-label {
                font-size: 16px;
                width: 80px;
            }

            .question-image {
                max-width: 200px;
            }

            /* Landing page desktop styling */
            .landing-page {
                flex-direction: column;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 100vh;
                /* ADDED: Fixed height for desktop */
            }

            .landing-banner {
                height: calc(100vh - 160px);
                /* CHANGED: Account for desktop content height */
                margin: 0;
                /* REMOVED: No margins for full coverage */
                border-radius: 0;
                /* REMOVED: No border radius */
                width: 100%;
                /* CHANGED: Full width */
                background-position: center;
                /* ENSURE: Center position for desktop */
            }

            .landing-content {
                height: 160px;
                /* INCREASED: More height for desktop button */
                padding: 40px;
                width: 100%;
            }

            .start-button {
                font-size: 22px;
                padding: 15px 30px;
                width: 300px;
                border-radius: 12px;
                margin: 0 auto;
            }

            /* Desktop test section */
            .test-container {
                max-width: 600px;
                margin: 0 auto;
                width: 600px;
                position: relative;
                min-height: 100vh;
                /* CHANGED: Use min-height for scrollability */
                overflow-y: auto;
                /* ADDED: Allow scrolling on desktop too */
            }

            .test-footer {
                position: relative;
                z-index: 5;
                background-color: transparent;
                color: #666;
                font-size: 14px;
                padding: 1vh 30px 4vh 30px;
            }

            .background-container {
                min-height: 100vh;
                width: 100%;
            }

            .questions-wrapper {
                position: relative;
                z-index: 5;
                background-color: transparent;
                min-height: auto;
                flex: 1;
            }

            .test-controls {
                position: relative;
                z-index: 5;
                background-color: transparent;
                padding: 3vh 30px 8vh 30px;
            }

            .background-container .container-logo {
                display: flex !important;
                justify-content: center;
                align-items: center;
                height: 8vh;
                padding: 1vh 0;
                margin-bottom: 2vh;
                position: relative;
                z-index: 10;
            }

            .background-container .container-logo img {
                height: 7vh;
                max-width: 300px;
                object-fit: contain;
            }

            .background-container .progress-container {
                padding: 2vh 30px;
                z-index: 10;
                position: relative;
            }

            .image-container {
                height: 300px;
            }

            .question-image {
                max-height: 250px;
                max-width: 400px;
            }

            .intro h2 {
                font-size: 28px;
            }

            .intro p {
                font-size: 20px;
            }

            .question-text {
                font-size: 28px;
                color: white;
            }

            .options label {
                font-size: 18px;
                padding: 15px;
                background-color: rgba(255, 255, 255, 0.9);
            }

            #question-counter {
                font-size: 16px;
            }

            button {
                font-size: 18px;
                padding: 12px 24px;
            }
        }
    </style>
</head>

<body>
    <div class="container" id="container">
        <!-- New Landing Page -->
        <div class="landing-page" id="landing-page">
            <div class="landing-banner">
                <!-- Image removed, just red background -->
            </div>
            <div class="landing-content">
                <button class="start-button" id="start-button">เริ่มกันเลย!</button>
            </div>
        </div>
    </div>

    <!-- Original intro section (now hidden by default) -->
    <div class="intro" id="intro-section" style="display: none;">
        <h2>คุณเป็นใครในจักรวาล POP MART</h2>
        <p>มาหาคำตอบไปพร้อมๆ กันได้เลย!</p>
    </div>

    <div class="test-container" id="test-section" style="display: none;">
        <!-- Background image container - 65% of screen height -->
        <!-- Contains logo, progress bar, and question counter -->
        <div class="background-container" id="background-container">
            <!-- Logo inside background container -->
            <div class="container-logo">
                <img src="img/logo.png" alt="POP MART">
            </div>

            <!-- Progress container inside background -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" id="progress-bar"></div>
                </div>
                <p id="question-counter">คำถาม 1 จาก 20</p>
            </div>
        </div>

        <div class="questions-wrapper">
            <div id="questions-container"></div>
        </div>

        <div class="test-controls">
            <button id="prev-btn">ย้อนกลับ</button>
            <button id="next-btn" disabled>ถัดไป</button>
        </div>

        <div class="test-footer">
            © POP MART. All rights reserved
        </div>
    </div>

    <div class="result-container" id="result-section">
        <h2>บุคลิกภาพของคุณคือ:</h2>
        <div class="personality-type" id="personality-type">INTJ</div>
        <img id="personality-image" class="personality-image" src="img/result/intj.png" alt="Personality Type Image">
        <h3 id="personality-title">The Architect</h3>
        <div class="type-description" id="type-description">
            <!-- Description will be inserted here -->
        </div>
        <button id="restart-btn">ทำแบบทดสอบอีกครั้ง</button>
    </div>
</body>

<script>
    const landingPage = document.getElementById('landing-page');
    const startButton = document.getElementById('start-button');
    const header = document.getElementById('header');
    const container = document.getElementById('container');

    // Questions for the personality test - revised for teenage audience with consistent format
    const questions = [
        {
            text: "ฉันชอบที่จะ",
            options: [
                "เรียนรู้และลองทำสิ่งใหม่ๆที่ท้าทาย",
                "ทำสิ่งที่คุ้นเคยและถนัดอยู่แล้ว"
            ],
            imgSrc: "img/img (1).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "อยู่คนเดียวเงียบๆในห้องส่วนตัว",
                "ออกไปเจอเพื่อนๆและสังสรรค์"
            ],
            imgSrc: "img/img (2).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "ให้คนอื่นใช้เหตุผลและความจริงในการคุยกับฉัน",
                "ให้คนอื่นใส่ใจความรู้สึกของฉันเป็นหลัก"
            ],
            imgSrc: "img/img (3).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "ทำงานหรือกิจกรรมให้เสร็จทีละอย่าง",
                "ทำหลายๆอย่างพร้อมกันและสลับไปมา"
            ],
            imgSrc: "img/img (4).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "ตัดสินใจโดยใช้ข้อมูลและความเป็นเหตุเป็นผล",
                "ตัดสินใจโดยใช้ความรู้สึกและสัญชาตญาณ"
            ],
            imgSrc: "img/img (5).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "เจาะลึกในเรื่องที่สนใจจริงๆเพียงไม่กี่เรื่อง",
                "รู้เรื่องหลากหลายแต่ไม่ต้องลงลึกมาก"
            ],
            imgSrc: "img/img (6).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "มีตารางกิจกรรมที่วางแผนไว้ชัดเจน",
                "ปล่อยให้วันเป็นไปตามสถานการณ์โดยไม่ต้องวางแผนมาก"
            ],
            imgSrc: "img/img (7).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "ทำงานหรือกิจกรรมที่เริ่มไว้จนเสร็จสมบูรณ์",
                "เริ่มต้นไอเดียหรือโปรเจคใหม่ๆที่น่าสนใจ"
            ],
            imgSrc: "img/img (8).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "ให้ทุกอย่างเป็นไปตามแผนที่วางไว้ไม่มีการเปลี่ยนแปลง",
                "เปลี่ยนแปลงแผนตามสถานการณ์และโอกาส"
            ],
            imgSrc: "img/img (9).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "ฟังคนอธิบายเรื่องราวเป็นภาพรวมและแนวคิดหลัก",
                "ฟังคนอธิบายเรื่องราวอย่างละเอียดเป็นขั้นตอน"
            ],
            imgSrc: "img/img (10).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "อยู่ในที่เงียบสงบไม่มีเสียงรบกวน",
                "อยู่ในที่ที่มีเสียงพูดคุยหรือดนตรีเบาๆเป็นพื้นหลัง"
            ],
            imgSrc: "img/img (11).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "วิเคราะห์ปัญหาและหาทางแก้ไข",
                "ช่วยเหลือและเข้าใจความรู้สึกของเพื่อน"
            ],
            imgSrc: "img/img (12).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "ฟังเรื่องราวเกี่ยวกับวิธีการและขั้นตอนที่ทำให้สิ่งนั้นสำเร็จ",
                "ฟังเรื่องราวเกี่ยวกับแรงบันดาลใจและความคิดสร้างสรรค์"
            ],
            imgSrc: "img/img (13).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "รับฟังข้อเสียของฉันอย่างตรงไปตรงมา",
                "รับฟังข้อเสียของฉันแบบอ้อมๆ"
            ],
            imgSrc: "img/img (14).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "ลงมือทำอะไรทันทีโดยไม่ต้องคิดนาน",
                "วางแผนอย่างละเอียดก่อนลงมือทำ"
            ],
            imgSrc: "img/img (15).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "จดจ่อกับสิ่งที่เกิดขึ้นในปัจจุบัน",
                "คิดเกี่ยวกับอนาคตและความเป็นไปได้ต่างๆ"
            ],
            imgSrc: "img/img (1).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "รับของขวัญแบบเซอร์ไพรส์ที่ไม่รู้มาก่อน",
                "เลือกของขวัญที่ชอบด้วยตัวเอง"
            ],
            imgSrc: "img/img (2).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "มีเวลาคิดให้นานๆก่อนจะต้องตัดสินใจอะไร",
                "ตัดสินใจทันทีโดยใช้ข้อมูลที่มีอยู่"
            ],
            imgSrc: "img/img (3).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "แสดงความคิดเห็นอย่างตรงไปตรงมาในกลุ่มเพื่อน",
                "คิดทบทวนให้ดีก่อนแสดงความคิดเห็นในกลุ่ม"
            ],
            imgSrc: "img/img (4).png"
        },
        {
            text: "ฉันชอบที่จะ",
            options: [
                "คุยกันตรงๆเพื่อแก้ไขปัญหาความขัดแย้ง",
                "หลีกเลี่ยงความขัดแย้งเพื่อรักษาความสงบ"
            ],
            imgSrc: "img/img (5).png"
        }
    ];

    // จัดกลุ่มคำอธิบายของแต่ละบุคลิกภาพ (ไม่แสดง code MBTI)
    const personalityTypes = {
        "ENFP": {
            title: "LABUBU",
            description: "ร่าเริง สนุกสนาน"
        },
        "ESFJ": {
            title: "Sweet Bean",
            description: "เป็นมิตร อ่อนโยน"
        },
        "ENTP": {
            title: "SKULLPANDA",
            description: "มีความคิดสร้างสรรค์ เป็นตัวของตัวเอง"
        },
        "ESFP": {
            title: "MOLLY",
            description: "สดใส อยากรู้อยากเห็น"
        },
        "ESTJ": {
            title: "KUBO",
            description: "กล้าหาญ มุ่งมั่น"
        },
        "ENFJ": {
            title: "PUKCY",
            description: "ช่วยเหลือ สร้างแรงบันดาลใจ"
        },
        "ENTJ": {
            title: "HACIPUPU",
            description: "ผู้นำ มีวิสัยทัศน์"
        },
        "ESTP": {
            title: "HACIPUPU",
            description: "ผจญภัย ชอบเรียนรู้"
        },
        "INFJ": {
            title: "DIMOO",
            description: "มีความฝัน ลองสิ่งใหม่ๆ"
        },
        "ISFJ": {
            title: "CRYBABY",
            description: "เข้าอกเข้าใจ อ่อนโยน"
        },
        "INFP": {
            title: "POLAR",
            description: "มองโลกในแง่ดี เป็นมิตร"
        },
        "ISFP": {
            title: "MOLLY",
            description: "อ่อนโยน มีน้ำใจ"
        },
        "INTJ": {
            title: "SKULLPANDA",
            description: "มีความคิดสร้างสรรค์ กล้าแสดงออก"
        },
        "ISTP": {
            title: "HIRONO",
            description: "ใจเย็น ช่างสังเกต"
        },
        "INTP": {
            title: "Zsiga",
            description: "ช่างสังเกต วิเคราะห์"
        },
        "ISTJ": {
            title: "PINO JELLY",
            description: "มีระเบียบ จัดการชีวิตได้ดี"
        }
    };

    // For dimension scoring
    // Question index -> dimension pair: ["e","i"], ["s","n"], ["t","f"], or ["j","p"]
    // (This is simpler: pick left => +1 to left trait, pick right => +1 to right trait)
    const questionMapping = {
        0: ["n", "s"],    // Q0: N vs S
        1: ["i", "e"],    // Q1: I vs E
        2: ["t", "f"],    // Q2: T vs F
        3: ["j", "p"],    // Q3: J vs P
        4: ["t", "f"],    // Q4: T vs F
        5: ["i", "e"],    // Q5: I vs E
        6: ["j", "p"],    // Q6: J vs P
        7: ["p", "j"],    // Q7: P vs J
        8: ["j", "p"],    // Q8: J vs P
        9: ["n", "s"],    // Q9: N vs S
        10: ["i", "e"],   // Q10: I vs E
        11: ["t", "f"],   // Q11: T vs F
        12: ["s", "n"],   // Q12: S vs N
        13: ["f", "t"],   // Q13: F vs T
        14: ["e", "i"],   // Q14: E vs I
        15: ["s", "n"],   // Q15: S vs N
        16: ["s", "n"],   // Q16: S vs N
        17: ["p", "j"],   // Q17: P vs J
        18: ["e", "i"],   // Q18: E vs I
        19: ["t", "f"]    // Q19: T vs F
    };

    // DOM references
    const questionsContainer = document.getElementById('questions-container');
    const progressBar = document.getElementById('progress-bar');
    const questionCounter = document.getElementById('question-counter');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const testSection = document.getElementById('test-section');
    const backgroundContainer = document.getElementById('background-container');
    const resultSection = document.getElementById('result-section');
    const personalityTypeElement = document.getElementById('personality-type');
    const personalityTitleElement = document.getElementById('personality-title');
    const typeDescriptionElement = document.getElementById('type-description');
    const restartBtn = document.getElementById('restart-btn');

    let currentQuestionIndex = 0;
    // Array to store answers:  null (unanswered), 0 (left clicked), 1 (right clicked)
    const answers = Array(questions.length).fill(null);

    function initTest() {
        questions.forEach((question, index) => {
            const qDiv = document.createElement('div');
            qDiv.className = 'question' + (index === 0 ? ' active' : '');
            qDiv.dataset.index = index;

            // Centered question text
            const qText = document.createElement('div');
            qText.className = 'question-text';
            qText.textContent = question.text;
            qDiv.appendChild(qText);

            const optsDiv = document.createElement('div');
            optsDiv.className = 'options';

            question.options.forEach((optTxt, optIdx) => {
                const inputId = `q${index}-opt${optIdx}`;
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.id = inputId;
                radio.name = `question-${index}`;
                radio.value = optIdx;

                if (answers[index] === optIdx) {
                    radio.checked = true;
                }

                radio.addEventListener('change', () => {
                    answers[index] = optIdx;
                    updateNavButtons();
                });

                const label = document.createElement('label');
                label.htmlFor = inputId;
                label.textContent = optTxt;

                optsDiv.appendChild(radio);
                optsDiv.appendChild(label);
            });

            qDiv.appendChild(optsDiv);
            questionsContainer.appendChild(qDiv);
        });

        updateNavButtons();
        updateProgress();
        // Set initial background image
        updateBackgroundImage();
    }

    function updateBackgroundImage() {
        const currentQuestion = questions[currentQuestionIndex];
        if (currentQuestion && currentQuestion.imgSrc) {
            backgroundContainer.style.backgroundImage = `url('${currentQuestion.imgSrc}')`;
        }
    }

    function goToQuestion(index) {
        document.querySelector('.question.active').classList.remove('active');
        document.querySelector(`.question[data-index="${index}"]`).classList.add('active');
        currentQuestionIndex = index;
        updateNavButtons();
        updateProgress();
        updateBackgroundImage(); // Update background when question changes
    }

    function goToNextQuestion() {
        if (currentQuestionIndex < questions.length - 1) {
            goToQuestion(currentQuestionIndex + 1);
        } else {
            showResults();
        }
    }

    function goToPrevQuestion() {
        if (currentQuestionIndex > 0) {
            goToQuestion(currentQuestionIndex - 1);
        } else {
            // If we're at the first question, go back to landing page
            testSection.style.display = 'none';
            container.style.display = 'flex'; // Show main container
            landingPage.style.display = 'flex';
        }
    }

    function updateNavButtons() {
        // Remove the line that disables the prev button
        // prevBtn.disabled = (currentQuestionIndex === 0);

        if (currentQuestionIndex === questions.length - 1) {
            nextBtn.textContent = 'ดูผลลัพธ์';
        } else {
            nextBtn.textContent = 'ถัดไป';
        }

        // Disable next if no answer for this question
        nextBtn.disabled = (answers[currentQuestionIndex] === null);
    }

    const totalQuestions = questions.length;

    function updateProgress() {
        const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
        progressBar.style.width = `${progress}%`;
        questionCounter.textContent = `คำถาม ${currentQuestionIndex + 1} จาก ${totalQuestions}`;
    }

    function calculateResults() {
        // Initialize trait counters
        const traits = {
            e: 0, i: 0, // Extraversion vs Introversion
            s: 0, n: 0, // Sensing vs Intuition
            t: 0, f: 0, // Thinking vs Feeling
            j: 0, p: 0  // Judging vs Perceiving
        };

        // Tally up the traits based on answers
        answers.forEach((answer, index) => {
            if (answer !== null) {
                const dimension = questionMapping[index];
                // If answer is 0 (left option), increment first trait
                // If answer is 1 (right option), increment second trait
                traits[dimension[answer]]++;
            }
        });

        // Determine dominant trait in each dimension
        let type = [
            traits.e > traits.i ? 'E' : 'I',
            traits.s > traits.n ? 'S' : 'N',
            traits.t > traits.f ? 'T' : 'F',
            traits.j > traits.p ? 'J' : 'P'
        ].join('');

        // Redirect ENTJ results to ENTP (new change)
        if (type === "ENTJ") {
            type = "ENTP";
        }

        // Redirect ENFP results to INFJ (existing redirect)
        if (type === "ENFP") {
            type = "INFJ";
        }

        // Calculate percentages for visualization
        const iPercent = Math.round((traits.i / (traits.i + traits.e)) * 100);
        const nPercent = Math.round((traits.n / (traits.n + traits.s)) * 100);
        const tPercent = Math.round((traits.t / (traits.t + traits.f)) * 100);
        const jPercent = Math.round((traits.j / (traits.j + traits.p)) * 100);

        return {
            type,
            iPercent,
            nPercent,
            tPercent,
            jPercent
        };
    }

    function showResults() {
        const results = calculateResults();
        personalityTypeElement.textContent = results.type;
        personalityTypeElement.style.display = "none";

        const typeData = personalityTypes[results.type] || {
            title: "Unknown",
            description: "No data found."
        };

        // Update the personality type image
        const personalityImage = document.getElementById('personality-image');
        personalityImage.src = `img/result/${results.type.toLowerCase()}.png`;
        personalityImage.alt = `${typeData.title}`;

        // The image will now be full screen due to the updated CSS
        personalityTitleElement.textContent = typeData.title;
        typeDescriptionElement.textContent = typeData.description;

        // Show the result section immediately without animations
        testSection.style.display = 'none';
        resultSection.style.display = 'block';
    }

    function restartTest() {
        answers.fill(null);
        const radioInputs = document.querySelectorAll('input[type="radio"]');
        radioInputs.forEach(r => (r.checked = false));

        // Return to landing page and show main container
        container.style.display = 'flex';
        landingPage.style.display = 'flex';

        goToQuestion(0);
        testSection.style.display = 'none';
        resultSection.style.display = 'none';
    }

    // Landing page button listener
    startButton.addEventListener('click', () => {
        landingPage.style.display = 'none';
        container.style.display = 'none'; // Hide main container
        testSection.style.display = 'flex';
        updateBackgroundImage(); // Set background when starting test
    });

    prevBtn.addEventListener('click', goToPrevQuestion);
    nextBtn.addEventListener('click', goToNextQuestion);
    restartBtn.addEventListener('click', restartTest);

    initTest();

</script>
</body>

</html>